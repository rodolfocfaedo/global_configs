# Template Did√°tico ‚Äî PostgreSQL + Spring Boot

> **Contexto fixo (j√° resolvido e fora deste guia)**
>
> * Windows user: **rodol**
> * Linux (WSL) user: **rodolfo**
> * WSL, Java e PostgreSQL **j√° instalados e funcionando**
> * Vari√°veis globais (`DB_HOST`, `DB_PORT`, `DB_USER`, `DB_PASSWORD`) **j√° configuradas**

Este documento existe para **uma √∫nica fun√ß√£o**:

üëâ explicar **exatamente o que muda de um projeto Spring Boot para outro**, e **s√≥ isso**.

Nada aqui √© setup global. Nada aqui √© reinstala√ß√£o. Nada aqui √© gambiarra.

---

## REGRA DE OURO

* ‚ùå Voc√™ **n√£o altera c√≥digo** para trocar ambiente
* ‚ùå Voc√™ **n√£o cria projetos diferentes** para DEV / TEST / PROD
* ‚ùå Voc√™ **n√£o muda o `application.yml` por ambiente**
* ‚úÖ Voc√™ roda **o mesmo projeto**, mudando **apenas vari√°veis**

> **Ambiente ‚â† c√≥digo**

---

## 1. Onde todo projeto deve morar (sempre igual)

Todos os projetos Spring Boot devem ficar **dentro do WSL**, no caminho:

```text
/home/rodolfo/dev/projects
```

Nunca rode projetos em `/mnt/c`.

---

## 2. Descompactar um projeto do Spring Initializr

### Passo 1 ‚Äî Ir para a pasta de projetos

```bash
cd /home/rodolfo/dev/projects
```

### Passo 2 ‚Äî Descompactar o ZIP vindo do Windows

```bash
unzip /mnt/c/Users/rodol/Downloads/meu-projeto.zip
```

### Passo 3 ‚Äî Entrar no projeto e ajustar permiss√µes

```bash
cd meu-projeto
chmod +x gradlew
```

Pronto. O projeto est√° no lugar certo.

---

## 3. Modelo de banco de dados (did√°tico e definitivo)

### Conceito central

* O **usu√°rio e a senha permanecem sempre os mesmos**
* Para **cada projeto**, voc√™ cria:

  * **um banco**
  * **um schema** dentro desse banco

> Usu√°rio fixo ‚Üí bancos diferentes ‚Üí schemas diferentes

---

## 4. Criar o banco do projeto (uma √∫nica vez)

### 4.1 Entrar no PostgreSQL como administrador

```bash
sudo -u postgres psql
```

### 4.2 Criar o banco

Regra de nome:

```text
<nome_do_projeto>_db
```

Exemplo:

```sql
CREATE DATABASE expenses_db;
```

### 4.3 Tornar o usu√°rio dono do banco

```sql
ALTER DATABASE expenses_db OWNER TO rodolfo;
```

> **Este comando √© o mais importante do processo**.
> Ele garante que nunca haver√° erro de permiss√£o.

---

## 5. Criar o schema do projeto

### 5.1 Entrar no banco

```sql
\c expenses_db
```

### 5.2 Criar o schema

```sql
CREATE SCHEMA expenses AUTHORIZATION rodolfo;
```

### 5.3 Definir schema padr√£o do usu√°rio

```sql
ALTER ROLE rodolfo
SET search_path TO expenses;
```

Agora, sempre que o usu√°rio `rodolfo` conectar, ele entrar√° diretamente no schema correto.

---

## 6. O √∫nico `application.yml` (n√£o muda nunca)

`src/main/resources/application.yml`

```yaml
spring:
  application:
    name: ${APP_NAME:app}

  datasource:
    url: jdbc:postgresql://${DB_HOST}:${DB_PORT}/${DB_NAME}
    username: ${DB_USER}
    password: ${DB_PASSWORD}
    driver-class-name: org.postgresql.Driver

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        default_schema: ${DB_SCHEMA}
        format_sql: true

server:
  port: ${SERVER_PORT:8080}
```

Nunca coloque valores fixos aqui.

---

## 7. O que realmente muda de projeto para projeto

Somente **nomes**, definidos como vari√°veis de ambiente:

```bash
export APP_NAME=expenses-api
export DB_NAME=expenses_db
export DB_SCHEMA=expenses
```

Nada al√©m disso.

---

## 8. Como trocar de ambiente (sem mexer no c√≥digo)

> Sempre esteja dentro da pasta do projeto:

```bash
cd /home/rodolfo/dev/projects/expenses-api
```

### DEV

```bash
export SPRING_PROFILES_ACTIVE=dev
export DB_NAME=expenses_db
./gradlew bootRun
```

### TEST

```bash
export SPRING_PROFILES_ACTIVE=test
export DB_NAME=expenses_test_db
./gradlew bootRun
```

### PROD

```bash
export SPRING_PROFILES_ACTIVE=prod
export DB_NAME=expenses_prod_db
./gradlew clean build
java -jar build/libs/*.jar
```

---

## 9. IntelliJ ‚Äî Vari√°veis de ambiente

```text
DB_HOST=localhost
DB_PORT=5432
DB_USER=rodolfo
DB_PASSWORD=*****
DB_NAME=
DB_SCHEMA=
```

---

## CONCLUS√ÉO

* Usu√°rio e senha **nunca mudam**
* C√≥digo **nunca muda**
* `application.yml` **nunca muda**
* S√≥ mudam **vari√°veis de ambiente**

Esse modelo √© simples, previs√≠vel e escal√°vel.
Salve este arquivo e reutilize em todos os projetos.
